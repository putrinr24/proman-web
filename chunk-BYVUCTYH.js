import{a as L,b as w}from"./chunk-ZZHFCBOO.js";import{f as j,h as D}from"./chunk-T2AGER3E.js";import{K as P,f as C,g as E,m as I}from"./chunk-Q7I35MCF.js";import{$a as y,Hb as p,Oa as n,Pb as r,Rb as s,Sb as f,Ta as _,f as b,fb as d,mb as c,nb as h,vb as t,wb as i,xb as v,yb as F,zb as S}from"./chunk-MH3Z5DCJ.js";import"./chunk-TSRGIXR5.js";function U(a,o){if(a&1&&(F(0),t(1,"div",14)(2,"div",2)(3,"h3",3),r(4,"Project Managers"),i(),t(5,"p",15),r(6),i()(),t(7,"div",2)(8,"h3",3),r(9,"Developers"),i(),t(10,"p",15),r(11),i()(),t(12,"div",2)(13,"h3",3),r(14,"Customers"),i(),t(15,"p",15),r(16),i()(),t(17,"div",2)(18,"h3",3),r(19,"Projects"),i(),t(20,"p",15),r(21),t(22,"span",16),r(23),i()()()(),S()),a&2){let e=p(2);n(6),s(" ",e.pmCount," "),n(5),s(" ",e.devCount," "),n(5),s(" ",e.custCount," "),n(5),s(" ",e.projectCount," "),n(2),s(" ( +",e.projectLastMonth," from last month ) ")}}function T(a,o){if(a&1&&(t(0,"li"),r(1),t(2,"span",19),r(3),i()()),a&2){let e=o.$implicit;n(),s(" ",e.name," "),n(2),s("(",e.project,")")}}function N(a,o){if(a&1&&(t(0,"div",17)(1,"ul"),d(2,T,4,2,"li",18),i()()),a&2){let e=p(2);n(2),c("ngForOf",e.draftFeatureList)}}function O(a,o){if(a&1&&(t(0,"li"),r(1),t(2,"span",19),r(3),i()()),a&2){let e=o.$implicit;n(),s(" ",e.name," "),n(2),s("(",e.project,")")}}function $(a,o){if(a&1&&(t(0,"div",17)(1,"ul"),d(2,O,4,2,"li",18),i()()),a&2){let e=p(2);n(2),c("ngForOf",e.progressFeatureList)}}function k(a,o){if(a&1&&(t(0,"li"),r(1),t(2,"span",19),r(3),i()()),a&2){let e=o.$implicit;n(),s(" ",e.name," "),n(2),s("(",e.project,")")}}function A(a,o){if(a&1&&(t(0,"div",17)(1,"ul"),d(2,k,4,2,"li",18),i()()),a&2){let e=p(2);n(2),c("ngForOf",e.completedFeatureList)}}function z(a,o){if(a&1&&(t(0,"li"),r(1),t(2,"span",19),r(3),i()()),a&2){let e=o.$implicit;n(),s(" ",e.name," "),n(2),s("(",e.project,")")}}function R(a,o){if(a&1&&(t(0,"div",17)(1,"ul"),d(2,z,4,2,"li",18),i()()),a&2){let e=p(2);n(2),c("ngForOf",e.cancelledFeatureList)}}function q(a,o){if(a&1&&(F(0),t(1,"div",1),d(2,U,24,5,"ng-container",0),t(3,"div",2)(4,"h3",3),r(5," Feature Progress Summary "),i(),t(6,"div",4)(7,"div",5)(8,"div",6)(9,"span"),r(10,"Draft"),i(),t(11,"span"),r(12),i()(),t(13,"div",7),v(14,"div",8),i(),t(15,"p",9),r(16),i(),d(17,N,3,1,"div",10),i(),t(18,"div",5)(19,"div",6)(20,"span"),r(21,"In Progress"),i(),t(22,"span"),r(23),i()(),t(24,"div",7),v(25,"div",11),i(),t(26,"p",9),r(27),i(),d(28,$,3,1,"div",10),i(),t(29,"div",5)(30,"div",6)(31,"span"),r(32,"Completed"),i(),t(33,"span"),r(34),i()(),t(35,"div",7),v(36,"div",12),i(),t(37,"p",9),r(38),i(),d(39,A,3,1,"div",10),i(),t(40,"div",5)(41,"div",6)(42,"span"),r(43,"Cancelled"),i(),t(44,"span"),r(45),i()(),t(46,"div",7),v(47,"div",13),i(),t(48,"p",9),r(49),i(),d(50,R,3,1,"div",10),i()()()(),S()),a&2){let e=p();n(2),c("ngIf",(e.authUser==null?null:e.authUser.role)===0),n(10),s("",e.draftPercent,"%"),n(2),h("width",e.draftPercent,"%"),n(2),f(" ",e.draftFeatures,"/",e.totalFeatures," features in draft "),n(),c("ngIf",e.draftFeatureList.length>0),n(6),s("",e.progressPercent,"%"),n(2),h("width",e.progressPercent,"%"),n(2),f(" ",e.progressFeatures,"/",e.totalFeatures," features in progress "),n(),c("ngIf",e.progressFeatureList.length>0),n(6),s("",e.completedPercent,"%"),n(2),h("width",e.completedPercent,"%"),n(2),f(" ",e.completedFeatures,"/",e.totalFeatures," features completed "),n(),c("ngIf",e.completedFeatureList.length>0),n(6),s("",e.cancelledPercent,"%"),n(2),h("width",e.cancelledPercent,"%"),n(2),f(" ",e.cancelledFeatures,"/",e.totalFeatures," features cancelled "),n(),c("ngIf",e.cancelledFeatureList.length>0)}}var M=class a{constructor(o,e,m){this.userService=o;this.projectService=e;this.authService=m}destroy$=new b;pmCount=0;devCount=0;custCount=0;projectCount=0;projectLastMonth=0;totalFeatures=0;draftFeatures=0;progressFeatures=0;completedFeatures=0;cancelledFeatures=0;draftPercent=0;progressPercent=0;completedPercent=0;cancelledPercent=0;draftFeatureList=[];progressFeatureList=[];completedFeatureList=[];cancelledFeatureList=[];authUser;ngOnInit(){this.authService.getCurrentUserData.subscribe(o=>{o&&(this.authUser=o)}),this.loadData()}ngAfterContentInit(){}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}loadData(){let o=new Date,e=new Date;e.setMonth(o.getMonth()-1),this.authUser.role===0&&this.userService.getUsers().subscribe(m=>{let u=m.data.users;this.pmCount=u.filter(l=>l.role===1).length,this.devCount=u.filter(l=>l.role===2).length,this.custCount=u.filter(l=>l.role===3).length}),this.projectService.getProjects().subscribe(m=>{let u=m.data.projects.filter(l=>!l.is_template);this.projectCount=m.data.count,this.projectLastMonth=u.filter(l=>new Date(l.created_at)>=e).length,this.totalFeatures=0,this.draftFeatures=0,this.progressFeatures=0,this.completedFeatures=0,this.cancelledFeatures=0,this.draftFeatureList=[],this.progressFeatureList=[],this.completedFeatureList=[],this.cancelledFeatureList=[],u.forEach(l=>{l.features.forEach(g=>{if(this.authUser.role===2&&Number(g.assigned_to)!==Number(this.authUser.id)||this.authUser.role===1&&Number(l.assigned_to)!==Number(this.authUser.id)&&Number(g.assigned_to)!==Number(this.authUser.id))return;this.totalFeatures++;let x={name:g.name,project:l.name};switch(g.status_name){case"Draft":this.draftFeatures++,this.draftFeatureList.push(x);break;case"Progress":this.progressFeatures++,this.progressFeatureList.push(x);break;case"Completed":this.completedFeatures++,this.completedFeatureList.push(x);break;case"Cancelled":this.cancelledFeatures++,this.cancelledFeatureList.push(x);break}})}),this.draftPercent=this.totalFeatures?Math.round(this.draftFeatures/this.totalFeatures*100):0,this.progressPercent=this.totalFeatures?Math.round(this.progressFeatures/this.totalFeatures*100):0,this.completedPercent=this.totalFeatures?Math.round(this.completedFeatures/this.totalFeatures*100):0,this.cancelledPercent=this.totalFeatures?Math.round(this.cancelledFeatures/this.totalFeatures*100):0})}static \u0275fac=function(e){return new(e||a)(_(L),_(w),_(j))};static \u0275cmp=y({type:a,selectors:[["app-dashboard"]],decls:1,vars:1,consts:[[4,"ngIf"],[1,"@container","space-y-6","p-3"],[1,"rounded-2xl","bg-white","p-6","shadow-sm"],[1,"text-sm","font-medium","text-gray-500"],[1,"mt-4","space-y-4"],[1,"group","relative"],[1,"mb-1","flex","justify-between","text-xs","text-gray-500"],[1,"h-4","w-full","cursor-pointer","rounded-full","bg-gray-200"],[1,"h-4","rounded-full","bg-yellow-500"],[1,"mt-1","text-xs","text-gray-500"],["class","absolute top-full left-0 z-10 mt-1 hidden rounded bg-gray-600 p-2 text-xs text-white shadow-lg group-hover:block",4,"ngIf"],[1,"h-4","rounded-full","bg-blue-500"],[1,"h-4","rounded-full","bg-green-500"],[1,"h-4","rounded-full","bg-red-500"],[1,"grid","grid-cols-1","gap-6","sm:grid-cols-2","lg:grid-cols-4"],[1,"mt-2","text-3xl","font-semibold","text-gray-900"],[1,"z-10","text-xs","text-gray-500"],[1,"absolute","top-full","left-0","z-10","mt-1","hidden","rounded","bg-gray-600","p-2","text-xs","text-white","shadow-lg","group-hover:block"],[4,"ngFor","ngForOf"],[1,"text-gray-300"]],template:function(e,m){e&1&&d(0,q,51,25,"ng-container",0),e&2&&c("ngIf",m.authUser)},dependencies:[P,I,C,E,D],encapsulation:2})};export{M as DashboardComponent};
