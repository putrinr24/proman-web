<div class="space-y-4">
  <div class="flex flex-col">
    <div
      class="flex w-full flex-col justify-between gap-2 sm:flex-row sm:items-center">
      <h1 class="text-sm font-bold text-black uppercase">Attachment List</h1>

      <div class="flex items-center gap-4 self-end sm:self-auto">
        <div class="flex gap-1">
          <ng-container *ngFor="let button of actionButtons">
            <button
              *ngIf="button.roles.includes(authUser.role)"
              type="button"
              class="btn-high flex h-8 w-8 cursor-pointer items-center justify-center rounded-md border border-gray-400 p-1 hover:bg-gray-100"
              [pTooltip]="button.label"
              (click)="button.action()">
              <fc-svg-loader
                [path]="button.icon"
                [className]="'[&>svg]:size-4 text-gray-400'">
              </fc-svg-loader>
            </button>
          </ng-container>
        </div>
      </div>
    </div>
  </div>

  <div class="max-h-[21rem] min-h-0 flex-1 overflow-auto">
    <div class="m-1 space-y-4" *ngIf="!loading && attachments.length > 0">
      <div
        *ngFor="let attachment of attachments"
        (click)="goToFeedback(attachment.id)"
        class="ring-tertiary-200 hover:bg-tertiary-50 cursor-pointer rounded-md bg-white p-4 text-sm text-gray-700 shadow-sm ring-1 transition-colors duration-200">
        <div class="space-y-2">
          <div
            class="flex flex-col gap-1 sm:flex-row sm:items-center sm:justify-between">
            <p class="order-2 text-sm text-gray-500 sm:order-1">
              Feature:
              <span class="text-gray-700">{{ attachment.feature?.name }} </span>
            </p>
            <div class="order-1 sm:order-2">
              <div
                class="inline-flex items-center justify-center gap-1 rounded bg-gray-100 px-2 py-1 text-xs font-medium text-gray-600">
                <fa-icon
                  [icon]="faClock"
                  class="text-xs text-gray-500"></fa-icon>
                <span>{{
                  attachment.created_at | date: 'd MMM y, hh:mm a'
                }}</span>
              </div>
            </div>
          </div>

          <div
            class="flex gap-1 overflow-x-auto sm:flex-wrap sm:overflow-visible">
            <div
              *ngFor="let file of attachment.attachment_files"
              class="h-10 w-10 shrink-0 rounded-md border border-gray-300 bg-white p-1">
              <fc-image-preview
                *ngIf="isImage(file.url); else fileIcon"
                [preview]="true"
                [src]="file.url"
                alt="Attachment File"
                class="h-full w-full object-cover"></fc-image-preview>

              <ng-template #fileIcon>
                <a
                  [href]="file.url"
                  target="_blank"
                  rel="noopener"
                  (click)="$event.stopPropagation()"
                  class="flex h-full w-full items-center justify-center">
                  <fa-icon
                    [icon]="getFileIcon(file.url)"
                    class="text-xl text-gray-500">
                  </fa-icon>
                </a>
              </ng-template>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div *ngIf="loading" class="flex flex-1 items-center justify-center p-6">
      <fc-loading></fc-loading>
    </div>

    <div
      *ngIf="!loading && attachments.length === 0"
      class="flex flex-1 items-center justify-center p-6">
      <fc-not-found text="No attachment found"></fc-not-found>
    </div>
  </div>

  <div
    *ngIf="!loading && attachments.length > 0"
    class="mt-auto w-full justify-end gap-3 py-3">
    <fc-pagination
      [rows]="rows"
      [page]="page"
      [totalPages]="totalPages"
      [totalRecords]="totalRecords"
      (onPageUpdate)="onPageUpdate($event)">
    </fc-pagination>
  </div>
</div>
